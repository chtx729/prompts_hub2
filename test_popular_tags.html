<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­é—¨æ ‡ç­¾åŠŸèƒ½æµ‹è¯• - AIæç¤ºè¯å®åº“</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: var(--background-color);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            background: var(--surface-color);
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { background: #f0fdf4; border: 1px solid #22c55e; color: #166534; }
        .error { background: #fef2f2; border: 1px solid #ef4444; color: #dc2626; }
        .warning { background: #fffbeb; border: 1px solid #f59e0b; color: #d97706; }
        .info { background: #f0f9ff; border: 1px solid #3b82f6; color: #1d4ed8; }
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            margin: var(--space-2);
            transition: var(--transition-fast);
        }
        button:hover { 
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        button:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            transform: none;
        }
        h2 { color: var(--text-primary); margin-top: 2rem; }
        h3 { color: var(--text-primary); }
        .demo-search-box {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin: var(--space-4) 0;
        }
        .demo-search-input-group {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-2) var(--space-3);
            gap: var(--space-2);
        }
        .demo-search-input-group i {
            color: var(--text-secondary);
        }
        .demo-search-input-group input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
        }
        .demo-search-input-group button {
            margin: 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/performance.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/prompts.js"></script>
    <script src="js/search.js"></script>
</head>
<body>
    <h1>ğŸ·ï¸ çƒ­é—¨æ ‡ç­¾åŠŸèƒ½æµ‹è¯•</h1>
    <p>æ­¤å·¥å…·ç”¨äºæµ‹è¯•çƒ­é—¨æœç´¢æ ‡ç­¾çš„æ˜¾ç¤ºå’Œç‚¹å‡»åŠŸèƒ½ã€‚</p>

    <div class="test-section">
        <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
        <div>
            <strong>æœç´¢ç®¡ç†å™¨ï¼š</strong>
            <span id="search-status">æ£€æŸ¥ä¸­...</span>
        </div>
        <div style="margin-top: var(--space-2);">
            <strong>çƒ­é—¨æ ‡ç­¾æ•°é‡ï¼š</strong>
            <span id="tags-count">æ£€æŸ¥ä¸­...</span>
        </div>
        <div style="margin-top: var(--space-2);">
            <strong>æ ‡ç­¾å®¹å™¨ï¼š</strong>
            <span id="container-status">æ£€æŸ¥ä¸­...</span>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ¨ æœç´¢æ¡†æ¼”ç¤º</h3>
        <p>è¿™æ˜¯ä¿®æ”¹åçš„æœç´¢æ¡†æ ·å¼ï¼Œçƒ­é—¨æ ‡ç­¾æ˜¾ç¤ºåœ¨æœç´¢æ¡†ä¸‹æ–¹ï¼š</p>
        
        <div class="demo-search-box">
            <div class="demo-search-input-group">
                <i class="fas fa-search"></i>
                <input type="text" id="demo-search-input" placeholder="æœç´¢æç¤ºè¯...">
                <button class="btn btn-primary">æœç´¢</button>
            </div>
            
            <!-- çƒ­é—¨æœç´¢æ ‡ç­¾ -->
            <div class="popular-tags-section">
                <span class="popular-tags-label">çƒ­é—¨æœç´¢æ ‡ç­¾ï¼š</span>
                <div class="popular-tags-container" id="demo-popular-tags-container">
                    <!-- æ¼”ç¤ºæ ‡ç­¾ -->
                    <span class="popular-tag" data-tag="å†™ä½œ">å†™ä½œ <span class="tag-count">(25)</span></span>
                    <span class="popular-tag" data-tag="ç¼–ç¨‹">ç¼–ç¨‹ <span class="tag-count">(18)</span></span>
                    <span class="popular-tag" data-tag="è¥é”€">è¥é”€ <span class="tag-count">(12)</span></span>
                    <span class="popular-tag" data-tag="AI">AI <span class="tag-count">(30)</span></span>
                    <span class="popular-tag" data-tag="åˆ›æ„">åˆ›æ„ <span class="tag-count">(8)</span></span>
                    <span class="popular-tag" data-tag="è®¾è®¡">è®¾è®¡ <span class="tag-count">(15)</span></span>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testLoadTags()" id="test-load-btn">æµ‹è¯•åŠ è½½æ ‡ç­¾</button>
        <button onclick="testRenderTags()" id="test-render-btn">æµ‹è¯•æ¸²æŸ“æ ‡ç­¾</button>
        <button onclick="testTagClick()" id="test-click-btn">æµ‹è¯•æ ‡ç­¾ç‚¹å‡»</button>
        <button onclick="testSearchFunction()" id="test-search-btn">æµ‹è¯•æœç´¢åŠŸèƒ½</button>
        <button onclick="runAllTests()" id="test-all-btn">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ” å®é™…æœç´¢æ¡†</h3>
        <p>è¿™æ˜¯å®é™…çš„æœç´¢æ¡†ï¼Œåº”è¯¥æ˜¾ç¤ºçœŸå®çš„çƒ­é—¨æ ‡ç­¾ï¼š</p>
        
        <div class="search-box">
            <div class="search-input-group">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="æœç´¢æç¤ºè¯...">
                <button class="btn btn-primary" id="search-btn">æœç´¢</button>
            </div>
            
            <!-- çƒ­é—¨æœç´¢æ ‡ç­¾ -->
            <div class="popular-tags-section">
                <span class="popular-tags-label">çƒ­é—¨æœç´¢æ ‡ç­¾ï¼š</span>
                <div class="popular-tags-container" id="popular-tags-container">
                    <!-- æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        function addResult(type, title, content) {
            const container = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        function updateStatus() {
            const searchStatus = document.getElementById('search-status');
            const tagsCount = document.getElementById('tags-count');
            const containerStatus = document.getElementById('container-status');
            
            // æ£€æŸ¥æœç´¢ç®¡ç†å™¨
            if (window.searchManager) {
                searchStatus.textContent = 'å·²åˆå§‹åŒ–';
                searchStatus.style.color = 'var(--success-color)';
                
                // æ£€æŸ¥æ ‡ç­¾æ•°é‡
                const tagCount = searchManager.popularTags ? searchManager.popularTags.length : 0;
                tagsCount.textContent = `${tagCount} ä¸ªæ ‡ç­¾`;
                tagsCount.style.color = tagCount > 0 ? 'var(--success-color)' : 'var(--warning-color)';
            } else {
                searchStatus.textContent = 'æœªåˆå§‹åŒ–';
                searchStatus.style.color = 'var(--error-color)';
                tagsCount.textContent = 'æ— æ³•æ£€æŸ¥';
                tagsCount.style.color = 'var(--error-color)';
            }
            
            // æ£€æŸ¥æ ‡ç­¾å®¹å™¨
            const container = document.getElementById('popular-tags-container');
            if (container) {
                const hasContent = container.innerHTML.trim().length > 0;
                containerStatus.textContent = hasContent ? 'å·²æ¸²æŸ“å†…å®¹' : 'å®¹å™¨ä¸ºç©º';
                containerStatus.style.color = hasContent ? 'var(--success-color)' : 'var(--warning-color)';
            } else {
                containerStatus.textContent = 'å®¹å™¨ä¸å­˜åœ¨';
                containerStatus.style.color = 'var(--error-color)';
            }
        }

        async function testLoadTags() {
            const btn = document.getElementById('test-load-btn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            try {
                addResult('info', 'æµ‹è¯•åŠ è½½æ ‡ç­¾', 'å¼€å§‹æµ‹è¯•æ ‡ç­¾åŠ è½½...');
                
                if (!window.searchManager) {
                    addResult('error', 'æµ‹è¯•å¤±è´¥', 'æœç´¢ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                    return;
                }

                const startTime = performance.now();
                await searchManager.loadPopularTags();
                const endTime = performance.now();
                const duration = endTime - startTime;

                const tagCount = searchManager.popularTags ? searchManager.popularTags.length : 0;
                const sampleTags = searchManager.popularTags ? searchManager.popularTags.slice(0, 3) : [];

                addResult('success', 'æ ‡ç­¾åŠ è½½æˆåŠŸ', 
                    `åŠ è½½æ—¶é—´: ${duration.toFixed(2)}ms\n` +
                    `æ ‡ç­¾æ•°é‡: ${tagCount}\n` +
                    `ç¤ºä¾‹æ ‡ç­¾: ${JSON.stringify(sampleTags, null, 2)}`
                );

                updateStatus();
            } catch (error) {
                addResult('error', 'æ ‡ç­¾åŠ è½½å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•åŠ è½½æ ‡ç­¾';
            }
        }

        async function testRenderTags() {
            const btn = document.getElementById('test-render-btn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            try {
                addResult('info', 'æµ‹è¯•æ¸²æŸ“æ ‡ç­¾', 'å¼€å§‹æµ‹è¯•æ ‡ç­¾æ¸²æŸ“...');
                
                if (!window.searchManager) {
                    addResult('error', 'æµ‹è¯•å¤±è´¥', 'æœç´¢ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                    return;
                }

                const container = document.getElementById('popular-tags-container');
                if (!container) {
                    addResult('error', 'æµ‹è¯•å¤±è´¥', 'æ ‡ç­¾å®¹å™¨ä¸å­˜åœ¨');
                    return;
                }

                const beforeContent = container.innerHTML;
                searchManager.renderPopularTags();
                const afterContent = container.innerHTML;

                const tagElements = container.querySelectorAll('.popular-tag');

                addResult('success', 'æ ‡ç­¾æ¸²æŸ“æˆåŠŸ', 
                    `æ¸²æŸ“å‰å†…å®¹é•¿åº¦: ${beforeContent.length}\n` +
                    `æ¸²æŸ“åå†…å®¹é•¿åº¦: ${afterContent.length}\n` +
                    `æ ‡ç­¾å…ƒç´ æ•°é‡: ${tagElements.length}\n` +
                    `ç¬¬ä¸€ä¸ªæ ‡ç­¾: ${tagElements[0] ? tagElements[0].textContent : 'æ— '}`
                );

                updateStatus();
            } catch (error) {
                addResult('error', 'æ ‡ç­¾æ¸²æŸ“å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•æ¸²æŸ“æ ‡ç­¾';
            }
        }

        async function testTagClick() {
            const btn = document.getElementById('test-click-btn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            try {
                addResult('info', 'æµ‹è¯•æ ‡ç­¾ç‚¹å‡»', 'å¼€å§‹æµ‹è¯•æ ‡ç­¾ç‚¹å‡»åŠŸèƒ½...');
                
                const container = document.getElementById('popular-tags-container');
                if (!container) {
                    addResult('error', 'æµ‹è¯•å¤±è´¥', 'æ ‡ç­¾å®¹å™¨ä¸å­˜åœ¨');
                    return;
                }

                const tagElements = container.querySelectorAll('.popular-tag');
                if (tagElements.length === 0) {
                    addResult('warning', 'æµ‹è¯•è·³è¿‡', 'æ²¡æœ‰æ‰¾åˆ°æ ‡ç­¾å…ƒç´ ï¼Œè¯·å…ˆè¿è¡Œæ ‡ç­¾æ¸²æŸ“æµ‹è¯•');
                    return;
                }

                // æ¨¡æ‹Ÿç‚¹å‡»ç¬¬ä¸€ä¸ªæ ‡ç­¾
                const firstTag = tagElements[0];
                const tagName = firstTag.dataset.tag;
                
                addResult('info', 'æ¨¡æ‹Ÿç‚¹å‡»', `ç‚¹å‡»æ ‡ç­¾: ${tagName}`);
                
                // è§¦å‘ç‚¹å‡»äº‹ä»¶
                firstTag.click();
                
                // æ£€æŸ¥æœç´¢æ¡†æ˜¯å¦æ›´æ–°
                const searchInput = document.getElementById('search-input');
                const inputValue = searchInput ? searchInput.value : '';
                
                addResult('success', 'æ ‡ç­¾ç‚¹å‡»æµ‹è¯•å®Œæˆ', 
                    `ç‚¹å‡»çš„æ ‡ç­¾: ${tagName}\n` +
                    `æœç´¢æ¡†å†…å®¹: ${inputValue}\n` +
                    `å†…å®¹åŒ¹é…: ${inputValue === tagName ? 'æ˜¯' : 'å¦'}`
                );

            } catch (error) {
                addResult('error', 'æ ‡ç­¾ç‚¹å‡»æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•æ ‡ç­¾ç‚¹å‡»';
            }
        }

        async function testSearchFunction() {
            const btn = document.getElementById('test-search-btn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            try {
                addResult('info', 'æµ‹è¯•æœç´¢åŠŸèƒ½', 'å¼€å§‹æµ‹è¯•æœç´¢åŠŸèƒ½...');
                
                if (!window.searchManager) {
                    addResult('error', 'æµ‹è¯•å¤±è´¥', 'æœç´¢ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                    return;
                }

                // æµ‹è¯•æœç´¢æ–¹æ³•
                const testQuery = 'AI';
                addResult('info', 'æ‰§è¡Œæœç´¢', `æœç´¢å…³é”®è¯: ${testQuery}`);
                
                searchManager.performSearch(testQuery);
                
                // æ£€æŸ¥æœç´¢å†å²
                const hasHistory = searchManager.searchHistory && searchManager.searchHistory.includes(testQuery);
                
                addResult('success', 'æœç´¢åŠŸèƒ½æµ‹è¯•å®Œæˆ', 
                    `æœç´¢å…³é”®è¯: ${testQuery}\n` +
                    `æ·»åŠ åˆ°å†å²: ${hasHistory ? 'æ˜¯' : 'å¦'}\n` +
                    `å†å²è®°å½•æ•°é‡: ${searchManager.searchHistory ? searchManager.searchHistory.length : 0}`
                );

            } catch (error) {
                addResult('error', 'æœç´¢åŠŸèƒ½æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•æœç´¢åŠŸèƒ½';
            }
        }

        async function runAllTests() {
            const btn = document.getElementById('test-all-btn');
            btn.disabled = true;
            btn.textContent = 'è¿è¡Œä¸­...';

            clearResults();
            addResult('info', 'å¼€å§‹å…¨é¢æµ‹è¯•', 'è¿è¡Œæ‰€æœ‰çƒ­é—¨æ ‡ç­¾æµ‹è¯•...');

            try {
                await testLoadTags();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testRenderTags();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testTagClick();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testSearchFunction();

                addResult('success', 'å…¨é¢æµ‹è¯•å®Œæˆ', 'æ‰€æœ‰çƒ­é—¨æ ‡ç­¾æµ‹è¯•å·²å®Œæˆ');
            } catch (error) {
                addResult('error', 'å…¨é¢æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'è¿è¡Œæ‰€æœ‰æµ‹è¯•';
            }
        }

        // ä¸ºæ¼”ç¤ºæ ‡ç­¾æ·»åŠ ç‚¹å‡»äº‹ä»¶
        function bindDemoTagEvents() {
            const demoContainer = document.getElementById('demo-popular-tags-container');
            if (demoContainer) {
                demoContainer.querySelectorAll('.popular-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const tagName = tag.dataset.tag;
                        const demoInput = document.getElementById('demo-search-input');
                        if (demoInput) {
                            demoInput.value = tagName;
                        }
                        
                        // æ·»åŠ è§†è§‰åé¦ˆ
                        tag.style.background = 'var(--primary-color)';
                        tag.style.color = 'white';
                        tag.style.borderColor = 'var(--primary-color)';
                        
                        setTimeout(() => {
                            tag.style.background = '';
                            tag.style.color = '';
                            tag.style.borderColor = '';
                        }, 300);
                        
                        addResult('info', 'æ¼”ç¤ºæ ‡ç­¾ç‚¹å‡»', `ç‚¹å‡»äº†æ¼”ç¤ºæ ‡ç­¾: ${tagName}`);
                    });
                });
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                updateStatus();
                bindDemoTagEvents();
                
                // å®šæœŸæ›´æ–°çŠ¶æ€
                setInterval(updateStatus, 3000);
            }, 1000);
        });
    </script>
</body>
</html>
