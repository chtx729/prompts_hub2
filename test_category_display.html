<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç±»å›¾æ ‡å’Œé¢œè‰²æ˜¾ç¤ºæµ‹è¯• - AIæç¤ºè¯å®åº“</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: var(--background-color);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            background: var(--surface-color);
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #f0fdf4; border: 1px solid #22c55e; color: #166534; }
        .error { background: #fef2f2; border: 1px solid #ef4444; color: #dc2626; }
        .warning { background: #fffbeb; border: 1px solid #f59e0b; color: #d97706; }
        .info { background: #f0f9ff; border: 1px solid #3b82f6; color: #1d4ed8; }
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            margin: var(--space-2);
            transition: var(--transition-fast);
        }
        button:hover { 
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        h2 { color: var(--text-primary); margin-top: 2rem; }
        h3 { color: var(--text-primary); }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--space-6);
            margin: var(--space-6) 0;
        }
        .category-demo {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin: var(--space-2) 0;
        }
        .category-info {
            background: var(--gray-50);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
            font-family: monospace;
            font-size: 12px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/myspace.js"></script>
</head>
<body>
    <h1>ğŸ¨ åˆ†ç±»å›¾æ ‡å’Œé¢œè‰²æ˜¾ç¤ºæµ‹è¯•</h1>
    <p>æ­¤å·¥å…·ç”¨äºæµ‹è¯•æç¤ºè¯å¡ç‰‡ä¸­åˆ†ç±»çš„å›¾æ ‡å’Œé¢œè‰²æ˜¾ç¤ºæ•ˆæœã€‚</p>

    <div class="test-section">
        <h3>ğŸ“Š åˆ†ç±»æ•°æ®æµ‹è¯•</h3>
        <button onclick="testCategoriesData()">è·å–åˆ†ç±»æ•°æ®</button>
        <button onclick="testPromptsWithCategories()">è·å–å¸¦åˆ†ç±»çš„æç¤ºè¯</button>
        <div id="data-results"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ  é¦–é¡µå¡ç‰‡æµ‹è¯•</h3>
        <button onclick="testHomePageCards()">æµ‹è¯•é¦–é¡µå¡ç‰‡æ˜¾ç¤º</button>
        <div id="home-results"></div>
        <div id="home-cards-demo" class="demo-grid"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ‘¤ æˆ‘çš„ç©ºé—´å¡ç‰‡æµ‹è¯•</h3>
        <button onclick="testMySpaceCards()">æµ‹è¯•æˆ‘çš„ç©ºé—´å¡ç‰‡æ˜¾ç¤º</button>
        <div id="myspace-results"></div>
        <div id="myspace-cards-demo" class="demo-grid"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ¨ åˆ†ç±»æ ·å¼æ¼”ç¤º</h3>
        <button onclick="showCategoryStyleDemo()">æ˜¾ç¤ºåˆ†ç±»æ ·å¼æ¼”ç¤º</button>
        <div id="style-demo"></div>
    </div>

    <script>
        function addResult(containerId, type, title, content) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testCategoriesData() {
            clearResults('data-results');
            
            try {
                addResult('data-results', 'info', 'æµ‹è¯•åˆ†ç±»æ•°æ®', 'æ­£åœ¨è·å–åˆ†ç±»ä¿¡æ¯...');

                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .limit(10);

                if (error) {
                    addResult('data-results', 'error', 'åˆ†ç±»æ•°æ®è·å–å¤±è´¥', error.message);
                    return;
                }

                addResult('data-results', 'success', 'åˆ†ç±»æ•°æ®è·å–æˆåŠŸ', `æ‰¾åˆ° ${data.length} ä¸ªåˆ†ç±»`);
                
                if (data.length > 0) {
                    const categoriesInfo = data.map(cat => `
åˆ†ç±»ID: ${cat.category_id}
åç§°: ${cat.name}
å›¾æ ‡: ${cat.icon || 'æ— '}
é¢œè‰²: ${cat.color || 'æ— '}
æè¿°: ${cat.description || 'æ— '}
                    `).join('\n---\n');
                    
                    addResult('data-results', 'info', 'åˆ†ç±»è¯¦ç»†ä¿¡æ¯', categoriesInfo);
                }

            } catch (error) {
                addResult('data-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        async function testPromptsWithCategories() {
            clearResults('data-results');
            
            try {
                addResult('data-results', 'info', 'æµ‹è¯•å¸¦åˆ†ç±»çš„æç¤ºè¯', 'æ­£åœ¨è·å–æç¤ºè¯æ•°æ®...');

                const result = await apiManager.getPrompts({
                    page: 1,
                    pageSize: 5
                });

                if (result.success) {
                    addResult('data-results', 'success', 'æç¤ºè¯æ•°æ®è·å–æˆåŠŸ', `æ‰¾åˆ° ${result.data.length} æ¡æç¤ºè¯`);
                    
                    if (result.data.length > 0) {
                        const promptsInfo = result.data.map(prompt => `
æç¤ºè¯: ${prompt.title}
åˆ†ç±»ID: ${prompt.category_id || 'æ— '}
åˆ†ç±»åç§°: ${prompt.category_name || 'æ— '}
åˆ†ç±»å¯¹è±¡: ${JSON.stringify(prompt.categories, null, 2)}
                        `).join('\n---\n');
                        
                        addResult('data-results', 'info', 'æç¤ºè¯åˆ†ç±»ä¿¡æ¯', promptsInfo);
                    }
                } else {
                    addResult('data-results', 'error', 'æç¤ºè¯æ•°æ®è·å–å¤±è´¥', result.error);
                }

            } catch (error) {
                addResult('data-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        async function testHomePageCards() {
            clearResults('home-results');
            clearResults('home-cards-demo');
            
            try {
                addResult('home-results', 'info', 'æµ‹è¯•é¦–é¡µå¡ç‰‡', 'æ­£åœ¨ç”Ÿæˆé¦–é¡µå¡ç‰‡...');

                const result = await apiManager.getPrompts({
                    page: 1,
                    pageSize: 3
                });

                if (result.success && result.data.length > 0) {
                    const container = document.getElementById('home-cards-demo');
                    
                    result.data.forEach(prompt => {
                        // ä½¿ç”¨UI.createPromptCardæ–¹æ³•åˆ›å»ºå¡ç‰‡
                        const card = UI.createPromptCard(prompt, 'card', {});
                        container.appendChild(card);
                        
                        // æ˜¾ç¤ºåˆ†ç±»ä¿¡æ¯
                        const categoryInfo = prompt.categories || {};
                        const categoryName = categoryInfo.name || prompt.category_name || 'æœªåˆ†ç±»';
                        const categoryColor = categoryInfo.color || '#4f46e5';
                        const categoryIcon = categoryInfo.icon || 'fas fa-folder';
                        
                        const infoDiv = document.createElement('div');
                        infoDiv.className = 'category-info';
                        infoDiv.innerHTML = `
åˆ†ç±»ä¿¡æ¯:
- åç§°: ${categoryName}
- å›¾æ ‡: ${categoryIcon}
- é¢œè‰²: ${categoryColor}
- æ•°æ®æº: ${prompt.categories ? 'categorieså¯¹è±¡' : 'category_nameå­—æ®µ'}
                        `;
                        container.appendChild(infoDiv);
                    });

                    addResult('home-results', 'success', 'é¦–é¡µå¡ç‰‡ç”ŸæˆæˆåŠŸ', `ç”Ÿæˆäº† ${result.data.length} ä¸ªå¡ç‰‡`);
                } else {
                    addResult('home-results', 'warning', 'æ²¡æœ‰æ•°æ®', 'æ²¡æœ‰æ‰¾åˆ°æç¤ºè¯æ•°æ®');
                }

            } catch (error) {
                addResult('home-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        async function testMySpaceCards() {
            clearResults('myspace-results');
            clearResults('myspace-cards-demo');
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) {
                    addResult('myspace-results', 'warning', 'éœ€è¦ç™»å½•', 'è¯·å…ˆç™»å½•ä»¥æµ‹è¯•æˆ‘çš„ç©ºé—´å¡ç‰‡');
                    return;
                }

                addResult('myspace-results', 'info', 'æµ‹è¯•æˆ‘çš„ç©ºé—´å¡ç‰‡', 'æ­£åœ¨ç”Ÿæˆæˆ‘çš„ç©ºé—´å¡ç‰‡...');

                const result = await apiManager.getPrompts({
                    page: 1,
                    pageSize: 3,
                    userId: session.user.id
                });

                if (result.success && result.data.length > 0) {
                    const container = document.getElementById('myspace-cards-demo');
                    
                    result.data.forEach(prompt => {
                        // ä½¿ç”¨mySpaceManager.createMyPromptCardæ–¹æ³•åˆ›å»ºå¡ç‰‡
                        if (window.mySpaceManager) {
                            const card = mySpaceManager.createMyPromptCard(prompt);
                            container.appendChild(card);
                            
                            // æ˜¾ç¤ºåˆ†ç±»ä¿¡æ¯
                            const categoryInfo = prompt.categories || {};
                            const categoryName = categoryInfo.name || prompt.category_name || 'æœªåˆ†ç±»';
                            const categoryColor = categoryInfo.color || '#4f46e5';
                            const categoryIcon = categoryInfo.icon || 'fas fa-folder';
                            
                            const infoDiv = document.createElement('div');
                            infoDiv.className = 'category-info';
                            infoDiv.innerHTML = `
åˆ†ç±»ä¿¡æ¯:
- åç§°: ${categoryName}
- å›¾æ ‡: ${categoryIcon}
- é¢œè‰²: ${categoryColor}
- æ•°æ®æº: ${prompt.categories ? 'categorieså¯¹è±¡' : 'category_nameå­—æ®µ'}
                            `;
                            container.appendChild(infoDiv);
                        }
                    });

                    addResult('myspace-results', 'success', 'æˆ‘çš„ç©ºé—´å¡ç‰‡ç”ŸæˆæˆåŠŸ', `ç”Ÿæˆäº† ${result.data.length} ä¸ªå¡ç‰‡`);
                } else {
                    addResult('myspace-results', 'warning', 'æ²¡æœ‰æ•°æ®', 'æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·çš„æç¤ºè¯æ•°æ®');
                }

            } catch (error) {
                addResult('myspace-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        function showCategoryStyleDemo() {
            clearResults('style-demo');
            
            const container = document.getElementById('style-demo');
            
            // æ¼”ç¤ºä¸åŒçš„åˆ†ç±»æ ·å¼
            const demoCategories = [
                { name: 'å†™ä½œ', icon: 'fas fa-pen', color: '#8b5cf6' },
                { name: 'ç¼–ç¨‹', icon: 'fas fa-code', color: '#10b981' },
                { name: 'è®¾è®¡', icon: 'fas fa-palette', color: '#f59e0b' },
                { name: 'è¥é”€', icon: 'fas fa-bullhorn', color: '#ef4444' },
                { name: 'æ•™è‚²', icon: 'fas fa-graduation-cap', color: '#3b82f6' },
                { name: 'å•†åŠ¡', icon: 'fas fa-briefcase', color: '#6366f1' }
            ];
            
            const demoDiv = document.createElement('div');
            demoDiv.innerHTML = `
                <h4>åˆ†ç±»æ ·å¼æ¼”ç¤º</h4>
                <div style="display: flex; flex-wrap: wrap; gap: var(--space-3); margin: var(--space-4) 0;">
                    ${demoCategories.map(cat => `
                        <span class="prompt-card-category" style="background-color: ${cat.color}">
                            <i class="${cat.icon}"></i>
                            ${cat.name}
                        </span>
                    `).join('')}
                </div>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: var(--space-4);">
                    ä»¥ä¸Šå±•ç¤ºäº†ä¸åŒåˆ†ç±»çš„å›¾æ ‡å’Œé¢œè‰²æ•ˆæœã€‚æ¯ä¸ªåˆ†ç±»éƒ½æœ‰ç‹¬ç‰¹çš„å›¾æ ‡å’Œé¢œè‰²ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«å†…å®¹ç±»å‹ã€‚
                </p>
            `;
            
            container.appendChild(demoDiv);
            
            addResult('style-demo', 'success', 'æ ·å¼æ¼”ç¤ºç”Ÿæˆå®Œæˆ', 'å·²æ˜¾ç¤ºä¸åŒåˆ†ç±»çš„å›¾æ ‡å’Œé¢œè‰²æ•ˆæœ');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testCategoriesData();
                showCategoryStyleDemo();
            }, 1000);
        });
    </script>
</body>
</html>
