<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ€æ¡†å…³é—­æµ‹è¯•</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--background-color);
        }
        .test-container {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--radius-xl);
            margin-bottom: 2rem;
        }
        .test-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            margin: 0.5rem;
        }
        .test-button:hover {
            background: var(--primary-hover);
        }
        .status-info {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”„ æ¨¡æ€æ¡†å…³é—­åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•ç™»å‡ºæ—¶æ˜¯å¦èƒ½æ­£ç¡®å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†</p>

        <div>
            <h3>1. æ‰“å¼€æ¨¡æ€æ¡†</h3>
            <button class="test-button" onclick="showModal('prompt-modal')">æ˜¾ç¤ºæç¤ºè¯æ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="showModal('profile-edit-modal')">æ˜¾ç¤ºä¸ªäººèµ„æ–™æ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="showModal('user-manual-modal')">æ˜¾ç¤ºä½¿ç”¨æ‰‹å†Œæ¨¡æ€æ¡†</button>
        </div>

        <div>
            <h3>2. æµ‹è¯•å…³é—­</h3>
            <button class="test-button" onclick="testCloseAllModals()">å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="updateModalStatus()">åˆ·æ–°æ¨¡æ€æ¡†çŠ¶æ€</button>
        </div>

        <div>
            <h3>3. æ¨¡æ€æ¡†çŠ¶æ€</h3>
            <div id="modal-status" class="status-info">æ£€æŸ¥ä¸­...</div>
        </div>
    </div>

    <!-- æµ‹è¯•ç”¨çš„æ¨¡æ€æ¡† -->
    <div class="modal" id="prompt-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æç¤ºè¯æ¨¡æ€æ¡†</h3>
                <button class="modal-close" onclick="hideModal('prompt-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„æç¤ºè¯æ¨¡æ€æ¡†</p>
                <p>ç”¨äºæµ‹è¯•ç™»å‡ºæ—¶æ˜¯å¦èƒ½æ­£ç¡®å…³é—­</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideModal('prompt-modal')">å…³é—­</button>
            </div>
        </div>
    </div>

    <div class="modal" id="profile-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ä¸ªäººèµ„æ–™ç¼–è¾‘</h3>
                <button class="modal-close" onclick="hideModal('profile-edit-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>è¿™æ˜¯ä¸ªäººèµ„æ–™ç¼–è¾‘æ¨¡æ€æ¡†</p>
                <form>
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" value="æµ‹è¯•ç”¨æˆ·">
                    </div>
                    <div class="form-group">
                        <label>ä¸ªäººç®€ä»‹</label>
                        <textarea>æµ‹è¯•ç®€ä»‹</textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideModal('profile-edit-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <div class="modal" id="user-manual-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>ä½¿ç”¨æ‰‹å†Œ</h3>
                <button class="modal-close" onclick="hideModal('user-manual-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>è¿™æ˜¯ä½¿ç”¨æ‰‹å†Œæ¨¡æ€æ¡†</p>
                <p>åŒ…å«è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideModal('user-manual-modal')">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>

    <script>
        function showModal(modalId) {
            console.log(`æ˜¾ç¤ºæ¨¡æ€æ¡†: ${modalId}`);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                updateModalStatus();
            } else {
                console.error(`æ‰¾ä¸åˆ°æ¨¡æ€æ¡†: ${modalId}`);
            }
        }

        function hideModal(modalId) {
            console.log(`éšè—æ¨¡æ€æ¡†: ${modalId}`);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                updateModalStatus();
            } else {
                console.error(`æ‰¾ä¸åˆ°æ¨¡æ€æ¡†: ${modalId}`);
            }
        }

        function testCloseAllModals() {
            console.log('æµ‹è¯•å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†');
            
            if (typeof authManager !== 'undefined' && typeof authManager.closeAllModals === 'function') {
                // ä½¿ç”¨çœŸå®çš„closeAllModalsæ–¹æ³•
                authManager.closeAllModals();
                console.log('âœ… ä½¿ç”¨authManager.closeAllModals()');
            } else {
                // å¤‡ç”¨æ–¹æ¡ˆ
                console.log('ä½¿ç”¨å¤‡ç”¨å…³é—­æ–¹æ³•');
                const activeModals = document.querySelectorAll('.modal.active');
                activeModals.forEach(modal => {
                    modal.classList.remove('active');
                    console.log(`å…³é—­æ¨¡æ€æ¡†: ${modal.id}`);
                });
            }
            
            updateModalStatus();
        }

        function updateModalStatus() {
            const statusDiv = document.getElementById('modal-status');
            const modals = ['prompt-modal', 'profile-edit-modal', 'user-manual-modal'];
            
            let status = 'æ¨¡æ€æ¡†çŠ¶æ€:\n';
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                const isActive = modal && modal.classList.contains('active');
                status += `${modalId}: ${isActive ? 'âœ… æ˜¾ç¤º' : 'âŒ éšè—'}\n`;
            });
            
            // æ£€æŸ¥authManager
            if (typeof authManager !== 'undefined') {
                status += `\nauthManagerå¯ç”¨: âœ…\n`;
                status += `closeAllModalsæ–¹æ³•: ${typeof authManager.closeAllModals === 'function' ? 'âœ…' : 'âŒ'}\n`;
            } else {
                status += `\nauthManagerå¯ç”¨: âŒ\n`;
            }
            
            statusDiv.textContent = status;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateModalStatus();
            
            // ç»‘å®šç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        hideModal(modal.id);
                    }
                });
            });
        });
    </script>
</body>
</html>
