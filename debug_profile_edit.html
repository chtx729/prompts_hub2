<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººèµ„æ–™ç¼–è¾‘è°ƒè¯•</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--background-color);
        }
        .debug-container {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--radius-xl);
            margin-bottom: 2rem;
        }
        .debug-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
        }
        .debug-section h3 {
            margin-top: 0;
            color: var(--text-primary);
        }
        .debug-info {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: var(--radius-md);
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
        }
        .test-button {
            margin: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--primary-color);
            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-md);
            cursor: pointer;
        }
        .test-button:hover {
            background: var(--primary-hover);
        }
        .error {
            color: var(--error-500);
        }
        .success {
            color: var(--success-500);
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ä¸ªäººèµ„æ–™ç¼–è¾‘åŠŸèƒ½è°ƒè¯•</h1>
        
        <div class="debug-section">
            <h3>1. è„šæœ¬åŠ è½½çŠ¶æ€</h3>
            <div id="script-status" class="debug-info">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="debug-section">
            <h3>2. å¯¹è±¡å¯ç”¨æ€§æ£€æŸ¥</h3>
            <div id="object-status" class="debug-info">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="debug-section">
            <h3>3. åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testShowModal()">æµ‹è¯•æ˜¾ç¤ºæ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="testShowProfileEdit()">æµ‹è¯•æ˜¾ç¤ºç¼–è¾‘èµ„æ–™</button>
            <button class="test-button" onclick="testAuthManager()">æµ‹è¯•è®¤è¯ç®¡ç†å™¨</button>
            <div id="test-results" class="debug-info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <div class="debug-section">
            <h3>4. æ¨¡æ€æ¡†HTMLæ£€æŸ¥</h3>
            <div id="modal-status" class="debug-info">æ£€æŸ¥ä¸­...</div>
        </div>
    </div>

    <!-- ä¸ªäººèµ„æ–™ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="profile-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> ç¼–è¾‘ä¸ªäººèµ„æ–™</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="profile-edit-form">
                    <div class="form-group">
                        <label for="profile-username">ç”¨æˆ·å</label>
                        <input type="text" id="profile-username" required placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    
                    <div class="form-group">
                        <label for="profile-bio">ä¸ªäººç®€ä»‹</label>
                        <textarea id="profile-bio" placeholder="ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±å§..." rows="3" maxlength="200"></textarea>
                        <small class="form-help">é€‰å¡«ï¼Œæœ€å¤š200å­—</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer justify-end">
                <button type="button" class="btn btn-outline" onclick="hideModal()">
                    å–æ¶ˆ
                </button>
                <button type="submit" form="profile-edit-form" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    ä¿å­˜ä¿®æ”¹
                </button>
            </div>
        </div>
    </div>

    <!-- æŒ‰æ­£ç¡®é¡ºåºåŠ è½½è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"
            onload="console.log('âœ… SupabaseåŠ è½½æˆåŠŸ')"
            onerror="console.error('âŒ SupabaseåŠ è½½å¤±è´¥')"></script>
    <script src="js/config.js"
            onload="console.log('âœ… ConfigåŠ è½½æˆåŠŸ')"
            onerror="console.error('âŒ ConfigåŠ è½½å¤±è´¥')"></script>
    <script src="js/auth.js"
            onload="console.log('âœ… AuthåŠ è½½æˆåŠŸ')"
            onerror="console.error('âŒ AuthåŠ è½½å¤±è´¥')"></script>
    <script src="js/ui.js"
            onload="console.log('âœ… UIåŠ è½½æˆåŠŸ')"
            onerror="console.error('âŒ UIåŠ è½½å¤±è´¥')"></script>

    <script>
        let debugLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            console.log(message);
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.textContent = debugLog.join('\n');
        }

        function checkScriptStatus() {
            const scripts = [
                { name: 'Supabase', check: () => typeof supabase !== 'undefined' },
                { name: 'Config', check: () => typeof APP_CONFIG !== 'undefined' },
                { name: 'AuthManager Class', check: () => typeof AuthManager !== 'undefined' },
                { name: 'UI Class', check: () => typeof UI !== 'undefined' },
                { name: 'authManager Instance', check: () => typeof authManager !== 'undefined' },
                { name: 'window.authManager', check: () => typeof window.authManager !== 'undefined' }
            ];

            let status = 'è„šæœ¬åŠ è½½çŠ¶æ€:\n';
            scripts.forEach(script => {
                const loaded = script.check();
                status += `${script.name}: ${loaded ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}\n`;
            });

            // æ£€æŸ¥å…·ä½“çš„é”™è¯¯
            status += '\nè¯¦ç»†æ£€æŸ¥:\n';
            try {
                status += `window.UI: ${typeof window.UI}\n`;
                status += `window.AuthManager: ${typeof window.AuthManager}\n`;
                status += `å…¨å±€UI: ${typeof UI}\n`;
                status += `å…¨å±€AuthManager: ${typeof AuthManager}\n`;
            } catch (e) {
                status += `æ£€æŸ¥è¿‡ç¨‹ä¸­å‡ºé”™: ${e.message}\n`;
            }

            document.getElementById('script-status').textContent = status;
        }

        function checkObjectStatus() {
            let status = 'å¯¹è±¡å¯ç”¨æ€§:\n';
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            status += `window.authManager: ${typeof window.authManager}\n`;
            status += `window.UI: ${typeof window.UI}\n`;
            status += `UI: ${typeof UI}\n`;
            status += `authManager: ${typeof authManager}\n`;
            
            // æ£€æŸ¥æ–¹æ³•
            if (typeof UI !== 'undefined') {
                status += `UI.showModal: ${typeof UI.showModal}\n`;
                status += `UI.showProfileEdit: ${typeof UI.showProfileEdit}\n`;
                status += `UI.hideModal: ${typeof UI.hideModal}\n`;
            }
            
            if (typeof authManager !== 'undefined') {
                status += `authManager.isAuthenticated: ${typeof authManager.isAuthenticated}\n`;
                status += `authManager.getCurrentUser: ${typeof authManager.getCurrentUser}\n`;
            }

            document.getElementById('object-status').textContent = status;
        }

        function checkModalStatus() {
            const modal = document.getElementById('profile-edit-modal');
            const form = document.getElementById('profile-edit-form');
            const usernameInput = document.getElementById('profile-username');
            
            let status = 'æ¨¡æ€æ¡†HTMLçŠ¶æ€:\n';
            status += `æ¨¡æ€æ¡†å…ƒç´ : ${modal ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            status += `è¡¨å•å…ƒç´ : ${form ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            status += `ç”¨æˆ·åè¾“å…¥æ¡†: ${usernameInput ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            
            document.getElementById('modal-status').textContent = status;
        }

        function testShowModal() {
            log('æµ‹è¯•æ˜¾ç¤ºæ¨¡æ€æ¡†...');
            try {
                if (typeof UI === 'undefined') {
                    log('âŒ UIå¯¹è±¡æœªå®šä¹‰', 'error');
                    return;
                }
                
                if (typeof UI.showModal !== 'function') {
                    log('âŒ UI.showModalæ–¹æ³•ä¸å­˜åœ¨', 'error');
                    return;
                }
                
                UI.showModal('profile-edit-modal');
                log('âœ… æ¨¡æ€æ¡†æ˜¾ç¤ºæˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ æ˜¾ç¤ºæ¨¡æ€æ¡†å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testShowProfileEdit() {
            log('æµ‹è¯•æ˜¾ç¤ºç¼–è¾‘èµ„æ–™...');
            try {
                if (typeof UI === 'undefined') {
                    log('âŒ UIå¯¹è±¡æœªå®šä¹‰', 'error');
                    return;
                }
                
                if (typeof UI.showProfileEdit !== 'function') {
                    log('âŒ UI.showProfileEditæ–¹æ³•ä¸å­˜åœ¨', 'error');
                    return;
                }
                
                UI.showProfileEdit();
                log('âœ… ç¼–è¾‘èµ„æ–™æ˜¾ç¤ºæˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ æ˜¾ç¤ºç¼–è¾‘èµ„æ–™å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testAuthManager() {
            log('æµ‹è¯•è®¤è¯ç®¡ç†å™¨...');
            try {
                if (typeof authManager === 'undefined') {
                    log('âŒ authManagerå¯¹è±¡æœªå®šä¹‰', 'error');
                    return;
                }
                
                const isAuth = authManager.isAuthenticated();
                const currentUser = authManager.getCurrentUser();
                
                log(`è®¤è¯çŠ¶æ€: ${isAuth}`, 'info');
                log(`å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.username || currentUser.email : 'æ— '}`, 'info');
                log('âœ… è®¤è¯ç®¡ç†å™¨æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ è®¤è¯ç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function hideModal() {
            console.log('å°è¯•éšè—æ¨¡æ€æ¡†');
            try {
                if (typeof UI !== 'undefined' && typeof UI.hideModal === 'function') {
                    UI.hideModal('profile-edit-modal');
                } else {
                    const modal = document.getElementById('profile-edit-modal');
                    if (modal) {
                        modal.classList.remove('active');
                        console.log('ä½¿ç”¨å¤‡ç”¨æ–¹æ³•éšè—æ¨¡æ€æ¡†');
                    } else {
                        console.error('æ‰¾ä¸åˆ°æ¨¡æ€æ¡†å…ƒç´ ');
                    }
                }
            } catch (error) {
                console.error('éšè—æ¨¡æ€æ¡†å¤±è´¥:', error);
            }
        }

        // æ‰‹åŠ¨åŠ è½½UIç±»ï¼ˆå¦‚æœè‡ªåŠ¨åŠ è½½å¤±è´¥ï¼‰
        function manualLoadUI() {
            if (typeof UI === 'undefined') {
                console.log('å°è¯•æ‰‹åŠ¨å®šä¹‰UIç±»...');

                // æ‰‹åŠ¨å®šä¹‰ä¸€ä¸ªç®€åŒ–çš„UIç±»
                window.UI = class UI {
                    static showModal(modalId) {
                        const modal = document.getElementById(modalId);
                        if (modal) {
                            modal.classList.add('active');
                            console.log(`æ¨¡æ€æ¡† ${modalId} å·²æ˜¾ç¤º`);
                        } else {
                            console.error(`æ‰¾ä¸åˆ°æ¨¡æ€æ¡†: ${modalId}`);
                        }
                    }

                    static hideModal(modalId) {
                        const modal = document.getElementById(modalId);
                        if (modal) {
                            modal.classList.remove('active');
                            console.log(`æ¨¡æ€æ¡† ${modalId} å·²éšè—`);
                        }
                    }

                    static showProfileEdit() {
                        console.log('æ˜¾ç¤ºä¸ªäººèµ„æ–™ç¼–è¾‘');

                        // å¡«å……å½“å‰ç”¨æˆ·ä¿¡æ¯
                        if (typeof authManager !== 'undefined' && authManager.isAuthenticated()) {
                            const currentUser = authManager.getCurrentUser();
                            if (currentUser) {
                                const usernameInput = document.getElementById('profile-username');
                                const bioInput = document.getElementById('profile-bio');

                                if (usernameInput) usernameInput.value = currentUser.username || '';
                                if (bioInput) bioInput.value = currentUser.bio || '';
                            }
                        }

                        this.showModal('profile-edit-modal');
                    }

                    static showNotification(message, type = 'info') {
                        console.log(`é€šçŸ¥ [${type}]: ${message}`);
                        alert(`${type.toUpperCase()}: ${message}`);
                    }
                };

                console.log('âœ… æ‰‹åŠ¨UIç±»å®šä¹‰å®Œæˆ');
                return true;
            }
            return false;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                // å…ˆå°è¯•æ‰‹åŠ¨åŠ è½½UI
                const manualLoaded = manualLoadUI();
                if (manualLoaded) {
                    log('ä½¿ç”¨æ‰‹åŠ¨å®šä¹‰çš„UIç±»');
                }

                checkScriptStatus();
                checkObjectStatus();
                checkModalStatus();
                log('è°ƒè¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            }, 1000);
        });
    </script>
</body>
</html>
