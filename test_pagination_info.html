<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†é¡µä¿¡æ¯æµ‹è¯• - AIæç¤ºè¯å®åº“</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f8fafc;
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #f0fdf4; border: 1px solid #22c55e; color: #166534; }
        .error { background: #fef2f2; border: 1px solid #ef4444; color: #dc2626; }
        .warning { background: #fffbeb; border: 1px solid #f59e0b; color: #d97706; }
        .info { background: #f0f9ff; border: 1px solid #3b82f6; color: #1d4ed8; }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover { background: #4338ca; }
        h2 { color: #1f2937; margin-top: 2rem; }
        h3 { color: #374151; }
        .pagination-demo {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
</head>
<body>
    <h1>ğŸ” åˆ†é¡µä¿¡æ¯æ˜¾ç¤ºæµ‹è¯•</h1>
    <p>æ­¤å·¥å…·ç”¨äºæµ‹è¯•é¦–é¡µåº•éƒ¨åˆ†é¡µç»„ä»¶çš„æ€»æ¡æ•°ä¿¡æ¯æ˜¾ç¤ºã€‚</p>

    <div class="test-section">
        <h3>ğŸ“Š åˆ†é¡µæ•°æ®æµ‹è¯•</h3>
        <button onclick="testPaginationData()">è·å–åˆ†é¡µæ•°æ®</button>
        <button onclick="testDifferentPages()">æµ‹è¯•ä¸åŒé¡µç </button>
        <div id="data-results"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ¨ åˆ†é¡µç»„ä»¶æ¸²æŸ“æµ‹è¯•</h3>
        <button onclick="renderPaginationDemo()">æ¸²æŸ“åˆ†é¡µç»„ä»¶</button>
        <button onclick="testDifferentScenarios()">æµ‹è¯•ä¸åŒåœºæ™¯</button>
        <div id="render-results"></div>
        
        <!-- åˆ†é¡µç»„ä»¶å®¹å™¨ -->
        <div class="pagination-demo">
            <h4>åˆ†é¡µç»„ä»¶é¢„è§ˆï¼š</h4>
            <div id="pagination"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ˆ å®é™…æ•°æ®æµ‹è¯•</h3>
        <button onclick="testRealData()">ä½¿ç”¨çœŸå®æ•°æ®æµ‹è¯•</button>
        <div id="real-results"></div>
    </div>

    <script>
        function addResult(containerId, type, title, content) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testPaginationData() {
            clearResults('data-results');
            
            try {
                addResult('data-results', 'info', 'æµ‹è¯•åˆ†é¡µæ•°æ®', 'æ­£åœ¨è·å–APIè¿”å›çš„åˆ†é¡µä¿¡æ¯...');

                const result = await apiManager.getPrompts({
                    page: 1,
                    pageSize: 10
                });

                if (result.success) {
                    const { pagination } = result;
                    const dataInfo = `
åˆ†é¡µæ•°æ®ç»“æ„:
{
  page: ${pagination.page}
  pageSize: ${pagination.pageSize}
  total: ${pagination.total}
  totalPages: ${pagination.totalPages}
}

è®¡ç®—ä¿¡æ¯:
- å½“å‰é¡µæ˜¾ç¤º: ç¬¬ ${(pagination.page - 1) * pagination.pageSize + 1}-${Math.min(pagination.page * pagination.pageSize, pagination.total)} æ¡
- æ€»æ¡æ•°: ${pagination.total} æ¡æç¤ºè¯
                    `;
                    addResult('data-results', 'success', 'åˆ†é¡µæ•°æ®è·å–æˆåŠŸ', dataInfo);
                } else {
                    addResult('data-results', 'error', 'åˆ†é¡µæ•°æ®è·å–å¤±è´¥', result.error);
                }

            } catch (error) {
                addResult('data-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        async function testDifferentPages() {
            clearResults('data-results');
            
            try {
                const pages = [1, 2, 3];
                
                for (const page of pages) {
                    addResult('data-results', 'info', `æµ‹è¯•ç¬¬${page}é¡µ`, 'æ­£åœ¨è·å–æ•°æ®...');
                    
                    const result = await apiManager.getPrompts({
                        page: page,
                        pageSize: 5
                    });

                    if (result.success) {
                        const { pagination } = result;
                        const startItem = (pagination.page - 1) * pagination.pageSize + 1;
                        const endItem = Math.min(pagination.page * pagination.pageSize, pagination.total);
                        
                        addResult('data-results', 'success', `ç¬¬${page}é¡µæ•°æ®`, `
æ˜¾ç¤ºç¬¬ ${startItem}-${endItem} æ¡ï¼Œå…± ${pagination.total} æ¡æç¤ºè¯
å®é™…è¿”å›: ${result.data.length} æ¡è®°å½•
                        `);
                    } else {
                        addResult('data-results', 'error', `ç¬¬${page}é¡µå¤±è´¥`, result.error);
                    }
                }

            } catch (error) {
                addResult('data-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        function renderPaginationDemo() {
            clearResults('render-results');
            
            // æ¨¡æ‹Ÿåˆ†é¡µæ•°æ®
            const mockPagination = {
                page: 2,
                pageSize: 10,
                total: 156,
                totalPages: 16
            };

            addResult('render-results', 'info', 'æ¸²æŸ“åˆ†é¡µç»„ä»¶', 'ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ¸²æŸ“åˆ†é¡µç»„ä»¶...');

            try {
                UI.createPagination(mockPagination, (page) => {
                    addResult('render-results', 'success', 'åˆ†é¡µç‚¹å‡»äº‹ä»¶', `ç”¨æˆ·ç‚¹å‡»äº†ç¬¬ ${page} é¡µ`);
                });

                addResult('render-results', 'success', 'åˆ†é¡µç»„ä»¶æ¸²æŸ“æˆåŠŸ', `
ä½¿ç”¨çš„æ•°æ®:
- å½“å‰é¡µ: ${mockPagination.page}
- æ¯é¡µæ¡æ•°: ${mockPagination.pageSize}
- æ€»æ¡æ•°: ${mockPagination.total}
- æ€»é¡µæ•°: ${mockPagination.totalPages}

åº”è¯¥æ˜¾ç¤º: "æ˜¾ç¤ºç¬¬ 11-20 æ¡ï¼Œå…± 156 æ¡æç¤ºè¯"
                `);

            } catch (error) {
                addResult('render-results', 'error', 'æ¸²æŸ“å¤±è´¥', error.message);
            }
        }

        function testDifferentScenarios() {
            clearResults('render-results');
            
            const scenarios = [
                {
                    name: 'ç¬¬ä¸€é¡µ',
                    pagination: { page: 1, pageSize: 10, total: 156, totalPages: 16 }
                },
                {
                    name: 'ä¸­é—´é¡µ',
                    pagination: { page: 5, pageSize: 10, total: 156, totalPages: 16 }
                },
                {
                    name: 'æœ€åä¸€é¡µ',
                    pagination: { page: 16, pageSize: 10, total: 156, totalPages: 16 }
                },
                {
                    name: 'ä¸æ»¡ä¸€é¡µ',
                    pagination: { page: 1, pageSize: 10, total: 7, totalPages: 1 }
                },
                {
                    name: 'æœ€åä¸€é¡µä¸æ»¡',
                    pagination: { page: 3, pageSize: 10, total: 25, totalPages: 3 }
                }
            ];

            scenarios.forEach((scenario, index) => {
                setTimeout(() => {
                    addResult('render-results', 'info', `åœºæ™¯${index + 1}: ${scenario.name}`, 'æ­£åœ¨æ¸²æŸ“...');
                    
                    try {
                        UI.createPagination(scenario.pagination, (page) => {
                            console.log(`${scenario.name} - ç‚¹å‡»ç¬¬ ${page} é¡µ`);
                        });

                        const startItem = (scenario.pagination.page - 1) * scenario.pagination.pageSize + 1;
                        const endItem = Math.min(scenario.pagination.page * scenario.pagination.pageSize, scenario.pagination.total);
                        
                        addResult('render-results', 'success', `${scenario.name} æ¸²æŸ“å®Œæˆ`, `
åº”è¯¥æ˜¾ç¤º: "æ˜¾ç¤ºç¬¬ ${startItem}-${endItem} æ¡ï¼Œå…± ${scenario.pagination.total} æ¡æç¤ºè¯"
                        `);

                    } catch (error) {
                        addResult('render-results', 'error', `${scenario.name} æ¸²æŸ“å¤±è´¥`, error.message);
                    }
                }, index * 1000);
            });
        }

        async function testRealData() {
            clearResults('real-results');
            
            try {
                addResult('real-results', 'info', 'ä½¿ç”¨çœŸå®æ•°æ®æµ‹è¯•', 'æ­£åœ¨è·å–çœŸå®çš„æç¤ºè¯æ•°æ®...');

                const result = await apiManager.getPrompts({
                    page: 1,
                    pageSize: 8
                });

                if (result.success) {
                    addResult('real-results', 'success', 'çœŸå®æ•°æ®è·å–æˆåŠŸ', `
è·å–åˆ° ${result.data.length} æ¡æç¤ºè¯
åˆ†é¡µä¿¡æ¯: ç¬¬${result.pagination.page}é¡µï¼Œå…±${result.pagination.totalPages}é¡µï¼Œæ€»è®¡${result.pagination.total}æ¡
                    `);

                    // ä½¿ç”¨çœŸå®æ•°æ®æ¸²æŸ“åˆ†é¡µç»„ä»¶
                    UI.createPagination(result.pagination, (page) => {
                        addResult('real-results', 'info', 'åˆ†é¡µäº¤äº’', `ç”¨æˆ·ç‚¹å‡»äº†ç¬¬ ${page} é¡µ`);
                        
                        // æ¨¡æ‹ŸåŠ è½½æ–°é¡µé¢æ•°æ®
                        setTimeout(async () => {
                            const newResult = await apiManager.getPrompts({
                                page: page,
                                pageSize: 8
                            });
                            
                            if (newResult.success) {
                                UI.createPagination(newResult.pagination, arguments.callee);
                                addResult('real-results', 'success', `ç¬¬${page}é¡µæ•°æ®åŠ è½½å®Œæˆ`, `
æ˜¾ç¤º ${newResult.data.length} æ¡è®°å½•
åˆ†é¡µä¿¡æ¯å·²æ›´æ–°
                                `);
                            }
                        }, 500);
                    });

                    addResult('real-results', 'success', 'çœŸå®åˆ†é¡µç»„ä»¶æ¸²æŸ“å®Œæˆ', 'è¯·æŸ¥çœ‹ä¸Šæ–¹çš„åˆ†é¡µç»„ä»¶é¢„è§ˆ');

                } else {
                    addResult('real-results', 'error', 'çœŸå®æ•°æ®è·å–å¤±è´¥', result.error);
                }

            } catch (error) {
                addResult('real-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testPaginationData();
                setTimeout(renderPaginationDemo, 1000);
            }, 1000);
        });
    </script>
</body>
</html>
