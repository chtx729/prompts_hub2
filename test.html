<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæç¤ºè¯å®åº“ - é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-item {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .success {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #166534;
        }
        .error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #dc2626;
        }
        .warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #d97706;
        }
        .info {
            background: #f0f9ff;
            border-color: #3b82f6;
            color: #1d4ed8;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover {
            background: #4338ca;
        }
        pre {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .status {
            font-weight: bold;
            margin-right: 0.5rem;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>ğŸ§ª AIæç¤ºè¯å®åº“ - é…ç½®æµ‹è¯•</h1>
    <p>æ­¤é¡µé¢å¸®åŠ©æ‚¨éªŒè¯åº”ç”¨é…ç½®æ˜¯å¦æ­£ç¡®ã€‚è¯·æŒ‰é¡ºåºè¿›è¡Œæµ‹è¯•ã€‚</p>

    <div id="test-results">
        <div class="test-item info">
            <div class="status">ğŸ“‹</div>
            <strong>æµ‹è¯•è¯´æ˜</strong><br>
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¾æ¬¡æµ‹è¯•å„é¡¹é…ç½®ã€‚ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡åå†ä½¿ç”¨ä¸»åº”ç”¨ã€‚
        </div>
    </div>

    <div style="margin: 2rem 0;">
        <button onclick="testSupabaseConnection()">1. æµ‹è¯• Supabase è¿æ¥</button>
        <button onclick="testDatabaseTables()">2. æµ‹è¯•æ•°æ®åº“è¡¨</button>
        <button onclick="testAuthentication()">3. æµ‹è¯•ç”¨æˆ·è®¤è¯</button>
        <button onclick="testAPI()">4. æµ‹è¯• API åŠŸèƒ½</button>
        <button onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    </div>

    <div class="test-item info">
        <h3>ğŸ“ é…ç½®æ£€æŸ¥æ¸…å•</h3>
        <ul>
            <li>âœ… å·²åˆ›å»º Supabase é¡¹ç›®</li>
            <li>âœ… å·²æ‰§è¡Œ <code>tables_sql.txt</code> ä¸­çš„ SQL è¯­å¥</li>
            <li>âœ… å·²å¤åˆ¶ <code>config.example.js</code> ä¸º <code>js/config.js</code></li>
            <li>âœ… å·²åœ¨ <code>js/config.js</code> ä¸­å¡«å…¥æ­£ç¡®çš„ Supabase URL å’Œ API Key</li>
            <li>âœ… å·²é€šè¿‡ HTTP æœåŠ¡å™¨è¿è¡Œåº”ç”¨ï¼ˆä¸æ˜¯ç›´æ¥æ‰“å¼€æ–‡ä»¶ï¼‰</li>
        </ul>
    </div>

    <script>
        let testResults = [];

        function addTestResult(name, status, message, details = '') {
            const container = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-item ${status}`;
            
            const statusIcon = status === 'success' ? 'âœ…' : status === 'error' ? 'âŒ' : 'âš ï¸';
            
            div.innerHTML = `
                <div class="status">${statusIcon}</div>
                <strong>${name}</strong><br>
                ${message}
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            
            container.appendChild(div);
            testResults.push({ name, status, message });
        }

        async function testSupabaseConnection() {
            try {
                // å°è¯•åŠ è½½é…ç½®
                const response = await fetch('js/config.js');
                const configText = await response.text();
                
                if (configText.includes('YOUR_SUPABASE_URL') || configText.includes('your-project')) {
                    addTestResult(
                        'Supabase è¿æ¥æµ‹è¯•',
                        'error',
                        'é…ç½®æ–‡ä»¶æœªæ­£ç¡®è®¾ç½®',
                        'è¯·åœ¨ js/config.js ä¸­å¡«å…¥æ­£ç¡®çš„ Supabase URL å’Œ API Key'
                    );
                    return;
                }

                // æ£€æŸ¥ supabase å¯¹è±¡æ˜¯å¦å­˜åœ¨
                if (typeof window.supabase === 'undefined') {
                    addTestResult(
                        'Supabase è¿æ¥æµ‹è¯•',
                        'error',
                        'Supabase åº“æœªåŠ è½½',
                        'è¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ŒSupabase CDN å¯ä»¥è®¿é—®'
                    );
                    return;
                }

                addTestResult(
                    'Supabase è¿æ¥æµ‹è¯•',
                    'success',
                    'Supabase åº“åŠ è½½æˆåŠŸï¼Œé…ç½®æ–‡ä»¶å·²æ›´æ–°'
                );

            } catch (error) {
                addTestResult(
                    'Supabase è¿æ¥æµ‹è¯•',
                    'error',
                    'è¿æ¥æµ‹è¯•å¤±è´¥',
                    error.message
                );
            }
        }

        async function testDatabaseTables() {
            try {
                // è¿™é‡Œéœ€è¦å®é™…çš„ supabase å®¢æˆ·ç«¯
                // ç”±äºé…ç½®åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åªèƒ½åšåŸºæœ¬æ£€æŸ¥
                addTestResult(
                    'æ•°æ®åº“è¡¨æµ‹è¯•',
                    'warning',
                    'è¯·æ‰‹åŠ¨éªŒè¯æ•°æ®åº“è¡¨',
                    'åœ¨ Supabase æ§åˆ¶å°ä¸­æ£€æŸ¥ä»¥ä¸‹è¡¨æ˜¯å¦å­˜åœ¨ï¼š\n- users\n- categories\n- prompts\n- user_likes\n- user_favorites\n- user_ratings\n- comments\n- usage_logs\n- system_configs'
                );
            } catch (error) {
                addTestResult(
                    'æ•°æ®åº“è¡¨æµ‹è¯•',
                    'error',
                    'æ•°æ®åº“æµ‹è¯•å¤±è´¥',
                    error.message
                );
            }
        }

        async function testAuthentication() {
            addTestResult(
                'ç”¨æˆ·è®¤è¯æµ‹è¯•',
                'info',
                'è®¤è¯åŠŸèƒ½éœ€è¦åœ¨ä¸»åº”ç”¨ä¸­æµ‹è¯•',
                'è¯·åœ¨ä¸»åº”ç”¨ä¸­å°è¯•æ³¨å†Œå’Œç™»å½•åŠŸèƒ½'
            );
        }

        async function testAPI() {
            addTestResult(
                'API åŠŸèƒ½æµ‹è¯•',
                'info',
                'API åŠŸèƒ½éœ€è¦åœ¨ä¸»åº”ç”¨ä¸­æµ‹è¯•',
                'è¯·åœ¨ä¸»åº”ç”¨ä¸­å°è¯•æµè§ˆæç¤ºè¯ã€æœç´¢ç­‰åŠŸèƒ½'
            );
        }

        async function runAllTests() {
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            const container = document.getElementById('test-results');
            container.innerHTML = `
                <div class="test-item info">
                    <div class="status">ğŸ§ª</div>
                    <strong>æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...</strong><br>
                    è¯·ç¨å€™ï¼Œæµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨ä¸‹æ–¹ã€‚
                </div>
            `;

            await testSupabaseConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testDatabaseTables();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testAuthentication();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testAPI();

            // æ˜¾ç¤ºæ€»ç»“
            const successCount = testResults.filter(r => r.status === 'success').length;
            const errorCount = testResults.filter(r => r.status === 'error').length;
            const warningCount = testResults.filter(r => r.status === 'warning').length;

            let summaryStatus = 'success';
            let summaryMessage = 'æ‰€æœ‰æµ‹è¯•å®Œæˆï¼';

            if (errorCount > 0) {
                summaryStatus = 'error';
                summaryMessage = `å‘ç° ${errorCount} ä¸ªé”™è¯¯ï¼Œè¯·ä¿®å¤åé‡è¯•`;
            } else if (warningCount > 0) {
                summaryStatus = 'warning';
                summaryMessage = `æœ‰ ${warningCount} ä¸ªè­¦å‘Šï¼Œè¯·æ£€æŸ¥ç›¸å…³é…ç½®`;
            }

            addTestResult(
                'æµ‹è¯•æ€»ç»“',
                summaryStatus,
                summaryMessage,
                `æˆåŠŸ: ${successCount}, è­¦å‘Š: ${warningCount}, é”™è¯¯: ${errorCount}`
            );

            if (errorCount === 0) {
                addTestResult(
                    'ä¸‹ä¸€æ­¥',
                    'success',
                    'é…ç½®éªŒè¯å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ä¸»åº”ç”¨',
                    'è®¿é—® index.html å¼€å§‹ä½¿ç”¨ AIæç¤ºè¯å®åº“'
                );
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.addEventListener('load', () => {
            addTestResult(
                'æ¬¢è¿ä½¿ç”¨é…ç½®æµ‹è¯•å·¥å…·',
                'info',
                'æ­¤å·¥å…·å°†å¸®åŠ©æ‚¨éªŒè¯ AIæç¤ºè¯å®åº“ çš„é…ç½®æ˜¯å¦æ­£ç¡®'
            );
        });
    </script>
</body>
</html>
