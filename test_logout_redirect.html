<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å‡ºé‡å®šå‘æµ‹è¯•</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--background-color);
        }
        .test-container {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--radius-xl);
            margin-bottom: 2rem;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
        }
        .test-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            margin: 0.5rem;
        }
        .test-button:hover {
            background: var(--primary-hover);
        }
        .status-info {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .page {
            display: none;
            padding: 2rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin: 1rem 0;
        }
        .page.active {
            display: block;
            border-color: var(--primary-color);
            background: var(--primary-50);
        }
        .nav-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            background: var(--gray-200);
            border-radius: var(--radius-md);
            text-decoration: none;
            color: var(--text-primary);
            cursor: pointer;
        }
        .nav-link.active {
            background: var(--primary-color);
            color: white;
        }
        .user-menu {
            display: none;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            margin: 1rem 0;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”„ ç™»å‡ºé‡å®šå‘åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•åœ¨"æˆ‘çš„ç©ºé—´"é¡µé¢ç™»å‡ºåæ˜¯å¦æ­£ç¡®è¿”å›é¦–é¡µ</p>

        <div class="test-section">
            <h3>1. å½“å‰çŠ¶æ€</h3>
            <div id="status-info" class="status-info">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="test-section">
            <h3>2. æ¨¡æ‹Ÿå¯¼èˆª</h3>
            <div>
                <span class="nav-link active" onclick="showPage('home-page')" data-page="home">é¦–é¡µ</span>
                <span class="nav-link" onclick="showPage('my-space-page')" data-page="my-space" id="my-space-link">æˆ‘çš„ç©ºé—´</span>
                <span class="nav-link" onclick="showPage('prompt-detail-page')" data-page="prompt-detail">æç¤ºè¯è¯¦æƒ…</span>
            </div>
        </div>

        <div class="test-section">
            <h3>3. æ¨¡æ‹Ÿç”¨æˆ·èœå•</h3>
            <div class="user-menu" id="user-menu">
                <div class="user-info">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=test" alt="å¤´åƒ" class="user-avatar" id="user-avatar">
                    <span class="username" id="username">æµ‹è¯•ç”¨æˆ·</span>
                </div>
                <button class="test-button" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    ç™»å‡º
                </button>
            </div>
        </div>

        <div class="test-section">
            <h3>4. æµ‹è¯•æ“ä½œ</h3>
            <button class="test-button" onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
            <button class="test-button" onclick="goToMySpace()">è¿›å…¥æˆ‘çš„ç©ºé—´</button>
            <button class="test-button" onclick="goToPromptDetail()">æŸ¥çœ‹æç¤ºè¯è¯¦æƒ…</button>
            <button class="test-button" onclick="testLogout()">æµ‹è¯•ç™»å‡º</button>
            <button class="test-button" onclick="updateStatus()">åˆ·æ–°çŠ¶æ€</button>
        </div>

        <div class="test-section">
            <h3>5. æµ‹è¯•æ­¥éª¤</h3>
            <h4>åœºæ™¯1ï¼šæˆ‘çš„ç©ºé—´é¡µé¢ç™»å‡º</h4>
            <ol>
                <li>ç‚¹å‡»"æ¨¡æ‹Ÿç™»å½•" - åº”è¯¥æ˜¾ç¤ºç”¨æˆ·èœå•å’Œæˆ‘çš„ç©ºé—´é“¾æ¥</li>
                <li>ç‚¹å‡»"è¿›å…¥æˆ‘çš„ç©ºé—´" - åº”è¯¥åˆ‡æ¢åˆ°æˆ‘çš„ç©ºé—´é¡µé¢</li>
                <li>ç‚¹å‡»"æµ‹è¯•ç™»å‡º" - åº”è¯¥è‡ªåŠ¨è¿”å›é¦–é¡µå¹¶éšè—ç”¨æˆ·ç›¸å…³UI</li>
                <li>æ£€æŸ¥çŠ¶æ€ä¿¡æ¯ç¡®è®¤é¡µé¢åˆ‡æ¢æˆåŠŸ</li>
            </ol>

            <h4>åœºæ™¯2ï¼šæç¤ºè¯è¯¦æƒ…é¡µé¢ç™»å‡º</h4>
            <ol>
                <li>ç‚¹å‡»"æ¨¡æ‹Ÿç™»å½•" - åº”è¯¥æ˜¾ç¤ºç”¨æˆ·èœå•å’Œæˆ‘çš„ç©ºé—´é“¾æ¥</li>
                <li>ç‚¹å‡»"æŸ¥çœ‹æç¤ºè¯è¯¦æƒ…" - åº”è¯¥åˆ‡æ¢åˆ°æç¤ºè¯è¯¦æƒ…é¡µé¢</li>
                <li>ç‚¹å‡»"æµ‹è¯•ç™»å‡º" - åº”è¯¥è‡ªåŠ¨è¿”å›é¦–é¡µå¹¶éšè—ç”¨æˆ·ç›¸å…³UI</li>
                <li>æ£€æŸ¥çŠ¶æ€ä¿¡æ¯ç¡®è®¤é¡µé¢åˆ‡æ¢æˆåŠŸ</li>
            </ol>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿé¡µé¢ -->
    <div class="test-container">
        <h3>é¡µé¢çŠ¶æ€æ¨¡æ‹Ÿ</h3>
        
        <div id="home-page" class="page active">
            <h4>ğŸ  é¦–é¡µ</h4>
            <p>è¿™æ˜¯é¦–é¡µå†…å®¹</p>
            <p>å½“å‰é¡µé¢ID: home-page</p>
        </div>

        <div id="my-space-page" class="page">
            <h4>ğŸ‘¤ æˆ‘çš„ç©ºé—´</h4>
            <p>è¿™æ˜¯æˆ‘çš„ç©ºé—´é¡µé¢å†…å®¹</p>
            <p>å½“å‰é¡µé¢ID: my-space-page</p>
            <p><strong>æµ‹è¯•åœºæ™¯ï¼šåœ¨æ­¤é¡µé¢ç™»å‡ºåº”è¯¥è‡ªåŠ¨è¿”å›é¦–é¡µ</strong></p>
        </div>

        <div id="prompt-detail-page" class="page">
            <h4>ğŸ“ æç¤ºè¯è¯¦æƒ…</h4>
            <p>è¿™æ˜¯æç¤ºè¯è¯¦æƒ…é¡µé¢å†…å®¹</p>
            <p>å½“å‰é¡µé¢ID: prompt-detail-page</p>
            <p><strong>æµ‹è¯•åœºæ™¯ï¼šä»æˆ‘çš„ç©ºé—´è¿›å…¥æ­¤é¡µé¢åç™»å‡ºï¼Œåº”è¯¥è‡ªåŠ¨è¿”å›é¦–é¡µ</strong></p>
            <p><em>æ³¨æ„ï¼šè¿™ä¸ªé¡µé¢é€šå¸¸æ˜¯ä»"æˆ‘çš„ç©ºé—´"é¡µé¢è·³è½¬è¿‡æ¥çš„</em></p>
        </div>
    </div>

    <script>
        let isLoggedIn = false;

        function updateStatus() {
            const statusDiv = document.getElementById('status-info');
            const currentPage = document.querySelector('.page.active');
            const userMenu = document.getElementById('user-menu');
            const mySpaceLink = document.getElementById('my-space-link');
            
            let status = `ç™»å½•çŠ¶æ€: ${isLoggedIn ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}\n`;
            status += `å½“å‰é¡µé¢: ${currentPage ? currentPage.id : 'æ— '}\n`;
            status += `ç”¨æˆ·èœå•æ˜¾ç¤º: ${userMenu.style.display !== 'none' ? 'âœ… æ˜¾ç¤º' : 'âŒ éšè—'}\n`;
            status += `æˆ‘çš„ç©ºé—´é“¾æ¥æ˜¾ç¤º: ${mySpaceLink.style.display !== 'none' ? 'âœ… æ˜¾ç¤º' : 'âŒ éšè—'}\n`;
            
            // æ£€æŸ¥authManagerçŠ¶æ€
            if (typeof authManager !== 'undefined') {
                status += `authManagerå¯ç”¨: âœ…\n`;
                status += `authManager.isAuthenticated(): ${authManager.isAuthenticated()}\n`;
                const currentUser = authManager.getCurrentUser();
                status += `å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.username || currentUser.email : 'æ— '}\n`;
            } else {
                status += `authManagerå¯ç”¨: âŒ\n`;
            }
            
            statusDiv.textContent = status;
        }

        function showPage(pageId) {
            console.log(`åˆ‡æ¢åˆ°é¡µé¢: ${pageId}`);
            
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[data-page="${pageId.replace('-page', '')}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            updateStatus();
        }

        function simulateLogin() {
            console.log('æ¨¡æ‹Ÿç™»å½•');
            isLoggedIn = true;
            
            // æ˜¾ç¤ºç”¨æˆ·èœå•å’Œæˆ‘çš„ç©ºé—´é“¾æ¥
            document.getElementById('user-menu').style.display = 'flex';
            document.getElementById('my-space-link').style.display = 'inline-block';
            
            updateStatus();
        }

        function goToMySpace() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆæ¨¡æ‹Ÿç™»å½•');
                return;
            }

            console.log('è¿›å…¥æˆ‘çš„ç©ºé—´');
            showPage('my-space-page');
        }

        function goToPromptDetail() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆæ¨¡æ‹Ÿç™»å½•');
                return;
            }

            console.log('æŸ¥çœ‹æç¤ºè¯è¯¦æƒ…ï¼ˆæ¨¡æ‹Ÿä»æˆ‘çš„ç©ºé—´è·³è½¬ï¼‰');
            showPage('prompt-detail-page');
        }

        function testLogout() {
            console.log('æµ‹è¯•ç™»å‡ºåŠŸèƒ½');
            
            if (typeof authManager !== 'undefined') {
                // ä½¿ç”¨çœŸå®çš„authManager
                authManager.handleUserSignOut(true);
            } else {
                // æ¨¡æ‹Ÿç™»å‡ºé€»è¾‘
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿç™»å‡ºé€»è¾‘');

                // æ£€æŸ¥å½“å‰é¡µé¢
                const currentPage = document.querySelector('.page.active');
                const mySpaceRelatedPages = ['my-space-page', 'prompt-detail-page'];

                if (currentPage && mySpaceRelatedPages.includes(currentPage.id)) {
                    console.log(`æ£€æµ‹åˆ°åœ¨${currentPage.id}é¡µé¢ï¼Œè¿”å›é¦–é¡µ`);
                    showPage('home-page');
                }

                // éšè—ç”¨æˆ·ç›¸å…³UI
                document.getElementById('user-menu').style.display = 'none';
                document.getElementById('my-space-link').style.display = 'none';

                isLoggedIn = false;
            }
            
            updateStatus();
        }

        // ç»‘å®šçœŸå®çš„ç™»å‡ºæŒ‰é’®
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', testLogout);
            }
            
            // åˆå§‹çŠ¶æ€æ›´æ–°
            updateStatus();
            
            // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
            if (typeof authManager !== 'undefined' && typeof authManager.onAuthStateChange === 'function') {
                authManager.onAuthStateChange((event, user) => {
                    console.log('è®¤è¯çŠ¶æ€å˜åŒ–:', event, user);
                    isLoggedIn = !!user;
                    updateStatus();
                });
            }
        });
    </script>
</body>
</html>
