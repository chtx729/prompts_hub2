<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªè¿”å›åŠŸèƒ½æµ‹è¯• - AIæç¤ºè¯å®åº“</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: var(--background-color);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            background: var(--surface-color);
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #f0fdf4; border: 1px solid #22c55e; color: #166534; }
        .error { background: #fef2f2; border: 1px solid #ef4444; color: #dc2626; }
        .warning { background: #fffbeb; border: 1px solid #f59e0b; color: #d97706; }
        .info { background: #f0f9ff; border: 1px solid #3b82f6; color: #1d4ed8; }
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            margin: var(--space-2);
            transition: var(--transition-fast);
        }
        button:hover { 
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        h2 { color: var(--text-primary); margin-top: 2rem; }
        h3 { color: var(--text-primary); }
        .navigation-flow {
            background: var(--gray-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin: var(--space-4) 0;
        }
        .flow-step {
            display: flex;
            align-items: center;
            margin: var(--space-2) 0;
            padding: var(--space-2);
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }
        .flow-step .step-number {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-right: var(--space-3);
        }
        .flow-step .step-content {
            flex: 1;
        }
        .flow-step .step-action {
            margin-left: var(--space-3);
        }
        .current-page-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            font-size: 12px;
        }
        .test-instructions {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin: var(--space-4) 0;
        }
        .test-instructions h4 {
            color: var(--primary-700);
            margin-bottom: var(--space-2);
        }
        .test-instructions ol {
            color: var(--primary-600);
            margin-left: var(--space-4);
        }
        .test-instructions li {
            margin: var(--space-1) 0;
        }
        .navigation-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: var(--space-3) 0;
        }
        .log-entry {
            margin: var(--space-1) 0;
            padding: var(--space-1);
            border-radius: var(--radius-sm);
        }
        .log-entry.navigation { background: rgba(139, 92, 246, 0.2); }
        .log-entry.detail { background: rgba(34, 197, 94, 0.2); }
        .log-entry.error { background: rgba(239, 68, 68, 0.2); }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/prompts.js"></script>
    <script src="js/myspace.js"></script>
</head>
<body>
    <h1>ğŸ”„ å¯¼èˆªè¿”å›åŠŸèƒ½æµ‹è¯•</h1>
    <p>æ­¤å·¥å…·ç”¨äºæµ‹è¯•ä»"æˆ‘çš„ç©ºé—´"æŸ¥çœ‹è¯¦æƒ…åè¿”å›çš„åŠŸèƒ½æ˜¯å¦æ­£ç¡®ã€‚</p>

    <div class="current-page-indicator" id="current-page-indicator">
        å½“å‰é¡µé¢: æµ‹è¯•é¡µé¢
    </div>

    <div class="test-section">
        <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
        <div>
            <strong>ç™»å½•çŠ¶æ€ï¼š</strong>
            <span id="login-status">æ£€æŸ¥ä¸­...</span>
        </div>
        <div style="margin-top: var(--space-2);">
            <strong>æç¤ºè¯ç®¡ç†å™¨ï¼š</strong>
            <span id="manager-status">æ£€æŸ¥ä¸­...</span>
        </div>
        <div style="margin-top: var(--space-2);">
            <strong>æˆ‘çš„ç©ºé—´ç®¡ç†å™¨ï¼š</strong>
            <span id="myspace-status">æ£€æŸ¥ä¸­...</span>
        </div>
        <div style="margin-top: var(--space-2);">
            <strong>å½“å‰è®°å½•çš„æ¥æºé¡µé¢ï¼š</strong>
            <span id="previous-page-status">æ£€æŸ¥ä¸­...</span>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <div class="test-instructions">
            <h4>æµ‹è¯•ç›®æ ‡</h4>
            <ol>
                <li><strong>é¦–é¡µ â†’ è¯¦æƒ… â†’ è¿”å›é¦–é¡µ</strong>ï¼šä»é¦–é¡µæŸ¥çœ‹è¯¦æƒ…ååº”è¯¥è¿”å›é¦–é¡µ</li>
                <li><strong>æˆ‘çš„ç©ºé—´ â†’ è¯¦æƒ… â†’ è¿”å›æˆ‘çš„ç©ºé—´</strong>ï¼šä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…ååº”è¯¥è¿”å›æˆ‘çš„ç©ºé—´</li>
                <li><strong>æ¥æºé¡µé¢è®°å½•</strong>ï¼šç³»ç»Ÿåº”è¯¥æ­£ç¡®è®°å½•æ¥æºé¡µé¢</li>
                <li><strong>è¿”å›æŒ‰é’®åŠŸèƒ½</strong>ï¼šè¿”å›æŒ‰é’®åº”è¯¥è¿”å›åˆ°æ­£ç¡®çš„é¡µé¢</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ”„ å¯¼èˆªæµç¨‹æµ‹è¯•</h3>
        <div class="navigation-flow">
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <strong>æ¨¡æ‹Ÿé¦–é¡µå¯¼èˆª</strong><br>
                    <small>æµ‹è¯•ä»é¦–é¡µæŸ¥çœ‹è¯¦æƒ…çš„è¿”å›åŠŸèƒ½</small>
                </div>
                <div class="step-action">
                    <button onclick="testHomeNavigation()" id="test-home-btn">æµ‹è¯•é¦–é¡µæµç¨‹</button>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <strong>æ¨¡æ‹Ÿæˆ‘çš„ç©ºé—´å¯¼èˆª</strong><br>
                    <small>æµ‹è¯•ä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…çš„è¿”å›åŠŸèƒ½</small>
                </div>
                <div class="step-action">
                    <button onclick="testMySpaceNavigation()" id="test-myspace-btn">æµ‹è¯•æˆ‘çš„ç©ºé—´æµç¨‹</button>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <strong>æµ‹è¯•è¿”å›åŠŸèƒ½</strong><br>
                    <small>ç›´æ¥æµ‹è¯•è¿”å›æŒ‰é’®çš„åŠŸèƒ½</small>
                </div>
                <div class="step-action">
                    <button onclick="testGoBackFunction()">æµ‹è¯•è¿”å›åŠŸèƒ½</button>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ å¯¼èˆªæ—¥å¿—</h3>
        <button onclick="clearNavigationLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button onclick="showCurrentState()">æ˜¾ç¤ºå½“å‰çŠ¶æ€</button>
        <div id="navigation-log" class="navigation-log">ç­‰å¾…å¯¼èˆªæ“ä½œ...</div>
    </div>

    <div class="test-section">
        <h3>ğŸ§ª æ‰‹åŠ¨æµ‹è¯•</h3>
        <button onclick="simulateHomePage()">æ¨¡æ‹Ÿé¦–é¡µ</button>
        <button onclick="simulateMySpacePage()">æ¨¡æ‹Ÿæˆ‘çš„ç©ºé—´</button>
        <button onclick="simulateDetailPage()">æ¨¡æ‹Ÿè¯¦æƒ…é¡µé¢</button>
        <button onclick="testReturnButton()">æµ‹è¯•è¿”å›æŒ‰é’®</button>
        <div id="manual-test-results"></div>
    </div>

    <script>
        let navigationLog = [];

        function addResult(containerId, type, title, content) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function addNavigationLog(message, type = 'navigation') {
            const timestamp = new Date().toLocaleTimeString();
            navigationLog.push({
                time: timestamp,
                message: message,
                type: type
            });
            updateNavigationLogDisplay();
        }

        function updateNavigationLogDisplay() {
            const container = document.getElementById('navigation-log');
            
            if (navigationLog.length === 0) {
                container.innerHTML = 'ç­‰å¾…å¯¼èˆªæ“ä½œ...';
                return;
            }
            
            const logHtml = navigationLog.map(entry => 
                `<div class="log-entry ${entry.type}">[${entry.time}] ${entry.message}</div>`
            ).join('');
            
            container.innerHTML = logHtml;
            container.scrollTop = container.scrollHeight;
        }

        function clearNavigationLog() {
            navigationLog = [];
            updateNavigationLogDisplay();
        }

        function updateStatus() {
            const loginStatus = document.getElementById('login-status');
            const managerStatus = document.getElementById('manager-status');
            const myspaceStatus = document.getElementById('myspace-status');
            const previousPageStatus = document.getElementById('previous-page-status');
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (window.authManager && authManager.isAuthenticated()) {
                loginStatus.textContent = 'å·²ç™»å½•';
                loginStatus.style.color = 'var(--success-color)';
            } else {
                loginStatus.textContent = 'æœªç™»å½•';
                loginStatus.style.color = 'var(--error-color)';
            }
            
            // æ£€æŸ¥æç¤ºè¯ç®¡ç†å™¨
            if (window.promptsManager) {
                managerStatus.textContent = 'å·²åˆå§‹åŒ–';
                managerStatus.style.color = 'var(--success-color)';
                
                // æ˜¾ç¤ºå½“å‰è®°å½•çš„æ¥æºé¡µé¢
                previousPageStatus.textContent = promptsManager.previousPage || 'æœªè®¾ç½®';
                previousPageStatus.style.color = 'var(--info-color)';
            } else {
                managerStatus.textContent = 'æœªåˆå§‹åŒ–';
                managerStatus.style.color = 'var(--error-color)';
                previousPageStatus.textContent = 'ç®¡ç†å™¨æœªåˆå§‹åŒ–';
                previousPageStatus.style.color = 'var(--error-color)';
            }
            
            // æ£€æŸ¥æˆ‘çš„ç©ºé—´ç®¡ç†å™¨
            if (window.mySpaceManager) {
                myspaceStatus.textContent = 'å·²åˆå§‹åŒ–';
                myspaceStatus.style.color = 'var(--success-color)';
            } else {
                myspaceStatus.textContent = 'æœªåˆå§‹åŒ–';
                myspaceStatus.style.color = 'var(--error-color)';
            }
        }

        function updateCurrentPageIndicator() {
            const indicator = document.getElementById('current-page-indicator');
            const activePageElement = document.querySelector('.page.active');
            
            if (activePageElement) {
                const pageName = activePageElement.id;
                const pageNames = {
                    'home-page': 'é¦–é¡µ',
                    'my-space-page': 'æˆ‘çš„ç©ºé—´',
                    'prompt-detail-page': 'æç¤ºè¯è¯¦æƒ…'
                };
                indicator.textContent = `å½“å‰é¡µé¢: ${pageNames[pageName] || pageName}`;
            } else {
                indicator.textContent = 'å½“å‰é¡µé¢: æµ‹è¯•é¡µé¢';
            }
        }

        // é‡å†™å…³é”®æ–¹æ³•æ¥ç›‘æ§å¯¼èˆª
        const originalShowPage = UI.showPage;
        UI.showPage = function(pageId) {
            addNavigationLog(`é¡µé¢åˆ‡æ¢: ${pageId}`, 'navigation');
            updateCurrentPageIndicator();
            return originalShowPage.call(this, pageId);
        };

        const originalShowPromptDetail = window.promptsManager?.showPromptDetail;
        if (originalShowPromptDetail) {
            window.promptsManager.showPromptDetail = function(promptId, fromPage) {
                addNavigationLog(`æŸ¥çœ‹è¯¦æƒ…: æç¤ºè¯ ${promptId}, æ¥æºé¡µé¢: ${fromPage || 'è‡ªåŠ¨æ£€æµ‹'}`, 'detail');
                return originalShowPromptDetail.call(this, promptId, fromPage);
            };
        }

        const originalGoBack = window.promptsManager?.goBack;
        if (originalGoBack) {
            window.promptsManager.goBack = function() {
                addNavigationLog(`æ‰§è¡Œè¿”å›: ç›®æ ‡é¡µé¢ ${this.previousPage}`, 'navigation');
                return originalGoBack.call(this);
            };
        }

        async function testHomeNavigation() {
            const btn = document.getElementById('test-home-btn');
            if (btn.disabled) return;

            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            clearResults('manual-test-results');
            addNavigationLog('å¼€å§‹æµ‹è¯•é¦–é¡µå¯¼èˆªæµç¨‹', 'navigation');

            try {
                if (!window.promptsManager) {
                    addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', 'æç¤ºè¯ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                    return;
                }

                // å…ˆè·å–çœŸå®çš„æç¤ºè¯ID
                addNavigationLog('è·å–çœŸå®æç¤ºè¯æ•°æ®...', 'navigation');
                const result = await apiManager.getPrompts({ page: 1, limit: 1 });

                if (!result.success || !result.data.length) {
                    addResult('manual-test-results', 'warning', 'æµ‹è¯•è·³è¿‡', 'æ²¡æœ‰æ‰¾åˆ°æç¤ºè¯æ•°æ®ï¼Œæ— æ³•æµ‹è¯•');
                    return;
                }

                const firstPrompt = result.data[0];
                addNavigationLog(`ä½¿ç”¨çœŸå®æç¤ºè¯ID: ${firstPrompt.prompt_id}`, 'navigation');

                // æ¨¡æ‹Ÿä»é¦–é¡µæŸ¥çœ‹è¯¦æƒ…
                addNavigationLog('è®¾ç½®æ¥æºé¡µé¢ä¸ºé¦–é¡µ', 'navigation');
                promptsManager.previousPage = 'home-page';

                // æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…
                addNavigationLog(`æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…ï¼ˆæç¤ºè¯ID: ${firstPrompt.prompt_id}ï¼‰`, 'detail');
                await promptsManager.showPromptDetail(firstPrompt.prompt_id, 'home-page');

                addResult('manual-test-results', 'success', 'é¦–é¡µå¯¼èˆªæµ‹è¯•', 'å·²æ¨¡æ‹Ÿä»é¦–é¡µæŸ¥çœ‹è¯¦æƒ…ï¼Œè¯·ç‚¹å‡»è¯¦æƒ…é¡µé¢çš„è¿”å›æŒ‰é’®æµ‹è¯•');
            } catch (error) {
                addNavigationLog(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•é¦–é¡µæµç¨‹';
            }
        }

        async function testMySpaceNavigation() {
            const btn = document.getElementById('test-myspace-btn');
            if (btn.disabled) return;

            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            clearResults('manual-test-results');
            addNavigationLog('å¼€å§‹æµ‹è¯•æˆ‘çš„ç©ºé—´å¯¼èˆªæµç¨‹', 'navigation');

            try {
                if (!window.promptsManager) {
                    addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', 'æç¤ºè¯ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                    return;
                }

                if (!authManager.isAuthenticated()) {
                    addResult('manual-test-results', 'warning', 'æµ‹è¯•è·³è¿‡', 'éœ€è¦ç™»å½•æ‰èƒ½æµ‹è¯•æˆ‘çš„ç©ºé—´åŠŸèƒ½');
                    return;
                }

                // å…ˆè·å–æˆ‘çš„æç¤ºè¯æ•°æ®
                addNavigationLog('è·å–æˆ‘çš„æç¤ºè¯æ•°æ®...', 'navigation');
                const result = await apiManager.getMyPrompts({ page: 1, limit: 1 });

                if (!result.success || !result.data.length) {
                    // å¦‚æœæ²¡æœ‰æˆ‘çš„æç¤ºè¯ï¼Œä½¿ç”¨é¦–é¡µçš„æç¤ºè¯è¿›è¡Œæµ‹è¯•
                    addNavigationLog('æ²¡æœ‰æˆ‘çš„æç¤ºè¯ï¼Œä½¿ç”¨é¦–é¡µæ•°æ®æµ‹è¯•...', 'navigation');
                    const homeResult = await apiManager.getPrompts({ page: 1, limit: 1 });

                    if (!homeResult.success || !homeResult.data.length) {
                        addResult('manual-test-results', 'warning', 'æµ‹è¯•è·³è¿‡', 'æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æç¤ºè¯æ•°æ®ï¼Œæ— æ³•æµ‹è¯•');
                        return;
                    }

                    const firstPrompt = homeResult.data[0];
                    addNavigationLog(`ä½¿ç”¨é¦–é¡µæç¤ºè¯IDè¿›è¡Œæµ‹è¯•: ${firstPrompt.prompt_id}`, 'navigation');

                    // æ¨¡æ‹Ÿä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…
                    addNavigationLog('è®¾ç½®æ¥æºé¡µé¢ä¸ºæˆ‘çš„ç©ºé—´', 'navigation');
                    promptsManager.previousPage = 'my-space-page';

                    // æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…
                    addNavigationLog(`æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…ï¼ˆæç¤ºè¯ID: ${firstPrompt.prompt_id}ï¼‰`, 'detail');
                    await promptsManager.showPromptDetail(firstPrompt.prompt_id, 'my-space-page');

                    addResult('manual-test-results', 'success', 'æˆ‘çš„ç©ºé—´å¯¼èˆªæµ‹è¯•', 'å·²æ¨¡æ‹Ÿä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…ï¼Œè¯·ç‚¹å‡»è¯¦æƒ…é¡µé¢çš„è¿”å›æŒ‰é’®æµ‹è¯•');
                    return;
                }

                const firstPrompt = result.data[0];
                addNavigationLog(`ä½¿ç”¨æˆ‘çš„æç¤ºè¯ID: ${firstPrompt.prompt_id}`, 'navigation');

                // æ¨¡æ‹Ÿä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…
                addNavigationLog('è®¾ç½®æ¥æºé¡µé¢ä¸ºæˆ‘çš„ç©ºé—´', 'navigation');
                promptsManager.previousPage = 'my-space-page';

                // æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…
                addNavigationLog(`æ¨¡æ‹ŸæŸ¥çœ‹è¯¦æƒ…ï¼ˆæç¤ºè¯ID: ${firstPrompt.prompt_id}ï¼‰`, 'detail');
                await promptsManager.showPromptDetail(firstPrompt.prompt_id, 'my-space-page');

                addResult('manual-test-results', 'success', 'æˆ‘çš„ç©ºé—´å¯¼èˆªæµ‹è¯•', 'å·²æ¨¡æ‹Ÿä»æˆ‘çš„ç©ºé—´æŸ¥çœ‹è¯¦æƒ…ï¼Œè¯·ç‚¹å‡»è¯¦æƒ…é¡µé¢çš„è¿”å›æŒ‰é’®æµ‹è¯•');
            } catch (error) {
                addNavigationLog(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•æˆ‘çš„ç©ºé—´æµç¨‹';
            }
        }

        function testGoBackFunction() {
            clearResults('manual-test-results');
            
            if (!window.promptsManager) {
                addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', 'æç¤ºè¯ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                return;
            }

            const currentPreviousPage = promptsManager.previousPage;
            addNavigationLog(`å½“å‰è®°å½•çš„æ¥æºé¡µé¢: ${currentPreviousPage}`, 'navigation');
            
            // æµ‹è¯•è¿”å›åŠŸèƒ½
            addNavigationLog('æ‰§è¡Œè¿”å›åŠŸèƒ½æµ‹è¯•', 'navigation');
            promptsManager.goBack();
            
            addResult('manual-test-results', 'success', 'è¿”å›åŠŸèƒ½æµ‹è¯•', `å·²æ‰§è¡Œè¿”å›ï¼Œç›®æ ‡é¡µé¢: ${currentPreviousPage}`);
        }

        function simulateHomePage() {
            addNavigationLog('æ‰‹åŠ¨åˆ‡æ¢åˆ°é¦–é¡µ', 'navigation');
            UI.showPage('home-page');
            if (window.promptsManager) {
                promptsManager.previousPage = 'home-page';
            }
        }

        function simulateMySpacePage() {
            addNavigationLog('æ‰‹åŠ¨åˆ‡æ¢åˆ°æˆ‘çš„ç©ºé—´', 'navigation');
            UI.showPage('my-space-page');
            if (window.promptsManager) {
                promptsManager.previousPage = 'my-space-page';
            }
        }

        function simulateDetailPage() {
            addNavigationLog('æ‰‹åŠ¨åˆ‡æ¢åˆ°è¯¦æƒ…é¡µé¢', 'navigation');
            UI.showPage('prompt-detail-page');
        }

        function testReturnButton() {
            clearResults('manual-test-results');
            
            if (!window.promptsManager) {
                addResult('manual-test-results', 'error', 'æµ‹è¯•å¤±è´¥', 'æç¤ºè¯ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                return;
            }

            addNavigationLog('æµ‹è¯•è¿”å›æŒ‰é’®åŠŸèƒ½', 'navigation');
            
            // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„è¿”å›æŒ‰é’®ç‚¹å‡»
            const returnButton = document.createElement('button');
            returnButton.textContent = 'æ¨¡æ‹Ÿè¿”å›æŒ‰é’®';
            returnButton.onclick = () => promptsManager.goBack();
            
            addResult('manual-test-results', 'info', 'è¿”å›æŒ‰é’®æµ‹è¯•', 'å·²åˆ›å»ºæ¨¡æ‹Ÿè¿”å›æŒ‰é’®');
            document.getElementById('manual-test-results').appendChild(returnButton);
        }

        function showCurrentState() {
            if (window.promptsManager) {
                addNavigationLog(`å½“å‰çŠ¶æ€ - æ¥æºé¡µé¢: ${promptsManager.previousPage}`, 'navigation');
            } else {
                addNavigationLog('æç¤ºè¯ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
            }
            
            const activePageElement = document.querySelector('.page.active');
            if (activePageElement) {
                addNavigationLog(`å½“å‰æ´»åŠ¨é¡µé¢: ${activePageElement.id}`, 'navigation');
            } else {
                addNavigationLog('æ²¡æœ‰æ´»åŠ¨é¡µé¢', 'navigation');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                updateStatus();
                updateCurrentPageIndicator();
                
                // åˆå§‹åŒ–ç®¡ç†å™¨
                if (!window.promptsManager) {
                    window.promptsManager = new PromptsManager();
                }
                
                // é‡æ–°ç»‘å®šæ–¹æ³•ç›‘æ§
                if (window.promptsManager && !originalShowPromptDetail) {
                    const originalMethod = window.promptsManager.showPromptDetail;
                    window.promptsManager.showPromptDetail = function(promptId, fromPage) {
                        addNavigationLog(`æŸ¥çœ‹è¯¦æƒ…: æç¤ºè¯ ${promptId}, æ¥æºé¡µé¢: ${fromPage || 'è‡ªåŠ¨æ£€æµ‹'}`, 'detail');
                        return originalMethod.call(this, promptId, fromPage);
                    };
                }
                
                if (window.promptsManager && !originalGoBack) {
                    const originalGoBackMethod = window.promptsManager.goBack;
                    window.promptsManager.goBack = function() {
                        addNavigationLog(`æ‰§è¡Œè¿”å›: ç›®æ ‡é¡µé¢ ${this.previousPage}`, 'navigation');
                        return originalGoBackMethod.call(this);
                    };
                }
                
                addNavigationLog('æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'navigation');
                
                // å®šæœŸæ›´æ–°çŠ¶æ€
                setInterval(() => {
                    updateStatus();
                    updateCurrentPageIndicator();
                }, 3000);
            }, 1000);
        });
    </script>
</body>
</html>
